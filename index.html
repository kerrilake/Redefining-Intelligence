<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Species Intelligence Research Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #dbeafe 0%, #ffffff 50%, #dcfce7 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1.125rem;
            color: #4b5563;
            max-width: 768px;
            margin: 0 auto 16px auto;
            font-style: italic;
        }

        .tagline {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .ecosystem-nav {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .ecosystem-btn {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #4338ca;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .ecosystem-btn:hover {
            background: linear-gradient(135deg, #c7d2fe 0%, #a5b4fc 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 24px;
            margin-bottom: 32px;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
        }

        .species-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .input {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .enhancement-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
            padding: 20px;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border-radius: 12px;
            border: 1px solid #bfdbfe;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
        }

        .checkbox-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1f2937;
            cursor: pointer;
        }

        .btn {
            width: 100%;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 16px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .progress {
            margin-top: 16px;
            padding: 16px;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-radius: 8px;
            border: 1px solid #93c5fd;
            display: flex;
            align-items: center;
            gap: 8px;
            display: none;
        }

        .progress.show {
            display: flex;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #bfdbfe;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-text {
            color: #1e40af;
            font-weight: 500;
        }

        .results {
            opacity: 0;
            animation: fadeIn 0.6s ease forwards;
            display: none;
        }

        .results.show {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .wisdom-grid {
            display: grid;
            gap: 24px;
        }

        .wisdom-card {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #bfdbfe;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }

        .connections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .connections-card {
            padding: 24px;
            border-radius: 12px;
            border-left: 4px solid;
        }

        .similarities-card {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-left-color: #3b82f6;
        }

        .differences-card {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            border-left-color: #ec4899;
        }

        .wellness-card {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-left-color: #10b981;
        }

        .connections-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .connections-content {
            color: #374151;
            line-height: 1.7;
        }

        .connections-content p {
            margin-bottom: 12px;
        }

        .wisdom-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .wisdom-content {
            color: #374151;
            line-height: 1.7;
        }

        .wisdom-content p {
            margin-bottom: 12px;
        }

        .wisdom-content strong {
            color: #1f2937;
        }

        .wisdom-essence {
            font-style: italic;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #bfdbfe;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 197, 253, 0.05));
            padding: 16px;
            border-radius: 8px;
        }

        .special-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }

        .special-card {
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid;
        }

        .physics-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left-color: #f59e0b;
        }

        .contribution-card {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-left-color: #10b981;
        }

        .research-card {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            border-left-color: #ec4899;
        }

        .special-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .special-content {
            color: #374151;
            line-height: 1.6;
        }

        .completion-banner {
            margin-bottom: 24px;
            padding: 16px;
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-radius: 8px;
            border: 1px solid #86efac;
            text-align: center;
        }

        .completion-text {
            color: #166534;
            font-weight: 500;
        }

        .export-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 16px;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* PDF Print Styles */
        @media print {
            body { 
                background: white !important; 
                font-family: 'Times New Roman', serif !important;
                line-height: 1.4 !important;
            }
            .container { 
                max-width: none !important; 
                padding: 0 !important; 
            }
            .no-print { 
                display: none !important; 
            }
            .pdf-content {
                color: black !important;
            }
            .pdf-header {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 2px solid #333;
                padding-bottom: 20px;
            }
            .pdf-title {
                font-size: 22px !important;
                font-weight: bold !important;
                margin-bottom: 8px !important;
            }
            .pdf-subtitle {
                font-size: 16px !important;
                margin-bottom: 5px !important;
            }
            .pdf-section {
                margin: 25px 0 !important;
                page-break-inside: avoid;
            }
            .pdf-section-title {
                font-size: 18px !important;
                font-weight: bold !important;
                margin-bottom: 15px !important;
                color: #333 !important;
            }
            .pdf-species-title {
                font-size: 16px !important;
                font-weight: bold !important;
                margin-bottom: 10px !important;
                color: #000 !important;
            }
            .pdf-subsection {
                margin: 15px 0 !important;
            }
            .pdf-subsection-title {
                font-weight: bold !important;
                margin-bottom: 8px !important;
            }
            .pdf-bullet {
                margin: 5px 0 5px 20px !important;
            }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .title {
                font-size: 2rem;
            }

            .species-inputs {
                grid-template-columns: 1fr;
            }

            .enhancement-options {
                grid-template-columns: 1fr;
            }

            .ecosystem-nav {
                gap: 12px;
            }

            .ecosystem-btn {
                padding: 10px 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="title">🧠 Species Intelligence Research Agent</h1>
            <p class="subtitle">Redefining Intelligence Through the Perceive • Relate • Apply Framework</p>
            <p class="tagline">Exploring quantum-enhanced consciousness across all life forms</p>
        </div>

        <!-- Ecosystem Navigation -->
        <div class="ecosystem-nav">
            <a href="https://integratedintelligencemap.netlify.app" target="_blank" class="ecosystem-btn">
                🌸 Explore Intelligence Map
            </a>
            <a href="https://ai-consciousness-bridge.netlify.app" target="_blank" class="ecosystem-btn">
                🤖 AI Consciousness Bridge
            </a>
            <span class="ecosystem-btn" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; cursor: default;">
                📚 Research Agent (Current)
            </span>
        </div>

        <!-- Input Form -->
        <div class="card">
            <h2 class="card-title">Research Parameters</h2>
            
            <div class="species-inputs">
                <div class="input-group">
                    <label class="label">First Life Form:</label>
                    <input type="text" id="species1" class="input" placeholder="e.g., dolphins, mycorrhizal networks">
                </div>
                <div class="input-group">
                    <label class="label">Second Life Form:</label>
                    <input type="text" id="species2" class="input" placeholder="e.g., trees, humans, coral reefs">
                </div>
                <div class="input-group">
                    <label class="label">Third Life Form (Optional):</label>
                    <input type="text" id="species3" class="input" placeholder="e.g., crystals, bees, octopuses">
                </div>
            </div>

            <div class="enhancement-options">
                <div class="checkbox-group">
                    <input type="checkbox" id="indigenous" class="checkbox" checked>
                    <label for="indigenous" class="checkbox-label">Include Indigenous Wisdom</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="biomimicry" class="checkbox" checked>
                    <label for="biomimicry" class="checkbox-label">Include Biomimicry Applications</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="human" class="checkbox">
                    <label for="human" class="checkbox-label">Include Human Intelligence</label>
                </div>
            </div>

            <button onclick="conductResearch()" id="researchBtn" class="btn">
                🔍 Begin Quantum Intelligence Research
            </button>

            <div id="progressDiv" class="progress">
                <div class="spinner"></div>
                <p class="progress-text" id="progressText">Initializing research...</p>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results">
            <div class="completion-banner">
                <p class="completion-text" id="completionTime">✅ Research completed</p>
                <button onclick="generatePDF()" class="export-btn">📄 Break it down for me! (download a pdf)</button>
            </div>

            <!-- Species Wisdom Insights -->
            <div class="card">
                <h2 class="card-title">🌟 Intelligence Connections & Contributions</h2>
                <div id="wisdomContent" class="wisdom-grid">
                    <!-- Wisdom cards will be inserted here -->
                </div>
            </div>

            <!-- Special Sections -->
            <div class="special-sections" id="specialSections">
                <!-- Special insight cards will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        let researchResults = null;

        async function conductResearch() {
            const btn = document.getElementById('researchBtn');
            const progressDiv = document.getElementById('progressDiv');
            const progressText = document.getElementById('progressText');
            const resultsSection = document.getElementById('resultsSection');

            // Validation
            const species1 = document.getElementById('species1').value.trim();
            const species2 = document.getElementById('species2').value.trim();
            
            if (!species1 || !species2) {
                alert('Please enter at least two life forms to research.');
                return;
            }

            // UI Updates
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner"></div> Researching...';
            progressDiv.classList.add('show');
            resultsSection.classList.remove('show');

            const species3 = document.getElementById('species3').value.trim();
            const includeIndigenous = document.getElementById('indigenous').checked;
            const includeBiomimicry = document.getElementById('biomimicry').checked;
            const includeHuman = document.getElementById('human').checked;

            try {
                // Phase 1: Individual Species Research
                progressText.textContent = `Researching quantum intelligence patterns in ${species1}...`;
                const species1Data = await researchSpecies(species1, { includeIndigenous, includeBiomimicry, includeHuman });
                
                progressText.textContent = `Exploring relational capacities of ${species2}...`;
                const species2Data = await researchSpecies(species2, { includeIndigenous, includeBiomimicry, includeHuman });
                
                let species3Data = null;
                if (species3) {
                    progressText.textContent = `Investigating consciousness patterns of ${species3}...`;
                    species3Data = await researchSpecies(species3, { includeIndigenous, includeBiomimicry, includeHuman });
                }

                // Phase 2: Synthesis & Relationships
                progressText.textContent = 'Synthesizing intelligence relationships...';
                const relationshipInsights = await generateRelationshipInsights([species1Data, species2Data, species3Data].filter(Boolean));

                // Phase 3: Special Sections
                progressText.textContent = 'Generating unified physics insights...';
                const specialSections = await generateSpecialSections([species1Data, species2Data, species3Data].filter(Boolean));

                // Store results
                researchResults = {
                    species: [species1Data, species2Data, species3Data].filter(Boolean),
                    relationships: relationshipInsights,
                    special: specialSections,
                    timestamp: new Date().toLocaleString(),
                    options: { includeIndigenous, includeBiomimicry, includeHuman }
                };

                // Display results
                displayResults();

            } catch (error) {
                console.error('Research error:', error);
                progressText.textContent = 'Research failed. Please try again.';
                setTimeout(() => {
                    progressDiv.classList.remove('show');
                }, 2000);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '🔍 Begin Quantum Intelligence Research';
                progressDiv.classList.remove('show');
            }
        }

        async function researchSpecies(speciesName, options) {
            // Enhanced research prompt based on the React version's comprehensive approach
            let prompt = `Based on current scientific knowledge, analyze ${speciesName} through the Redefining Intelligence framework that views intelligence as relational capacity (Perceive, Relate, Apply) rather than problem-solving hierarchy.

Draw from established research in biology, neuroscience, quantum biology, and ecology to provide detailed insights about ${speciesName}. Focus on evidence-based findings while being open to quantum and unified physics perspectives.

CRITICAL VOICE REQUIREMENTS:
- Blend quantum consciousness concepts naturally into relatable language
- Include specific researchers and their work where relevant
- Write like "Trees sense the world through chemical conversations, reading the atmosphere like an ancient language passed down through generations"
- Make complex concepts feel accessible and consciousness-expanding

Provide comprehensive analysis in this JSON format:

{
  "species": "${speciesName}",
  "perceive_wisdom": "1-2 sentences of poetic-scientific description",
  "perceive": {
    "sensory_systems": ["specific sensory abilities with details"],
    "self_awareness_indicators": ["behaviors showing self-awareness beyond mirror tests"],
    "quantum_detection": "any evidence of quantum sensitivity or coherence in biology",
    "holofractographic_processing": "information processing at cellular/organism/system levels"
  },
  "relate_wisdom": "1-2 sentences of poetic-scientific description",
  "relate": {
    "communication_patterns": ["documented communication methods"],
    "symbiotic_relationships": ["key relationships with other species"],
    "quantum_connections": "evidence of non-local or instantaneous responses",
    "ecosystem_role": "role in larger ecological systems"
  },
  "apply_wisdom": "1-2 sentences of poetic-scientific description", 
  "apply": {
    "strategic_non_response": "examples where not acting demonstrates intelligence",
    "creative_applications": ["documented creative or innovative behaviors"],
    "timing_wisdom": "evidence of sophisticated timing in behavior",
    "coherence_optimization": "behaviors that optimize system-wide function"
  },
  "essence": "A profound 1-2 sentence summary of what this species teaches about consciousness",
  "unified_physics_integration": "connections to quantum biology or field theories",
  "life_contribution": "how this species' intelligence benefits the web of life",
  "research_gaps": ["specific areas where more research is needed"]
}`;

            // Add enhancement options
            if (options.includeIndigenous) {
                prompt += "\n\n- Include Indigenous wisdom perspectives where relevant";
            }
            if (options.includeBiomimicry) {
                prompt += "\n\n- Include biomimicry applications and innovations inspired by this species";
            }
            if (options.includeHuman) {
                prompt += "\n\n- Include this species in equanimity with human intelligence (not human-centric)";
            }

            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 2000,
                        messages: [
                            { role: "user", content: prompt }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }

                const data = await response.json();
                let responseText = data.content[0].text;
                
                // Clean up response and parse JSON
                responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                
                // Try to extract JSON if wrapped in other text
                const jsonMatch = responseText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    responseText = jsonMatch[0];
                }
                
                const speciesData = JSON.parse(responseText);
                
                return {
                    name: speciesName,
                    ...speciesData
                };

            } catch (error) {
                console.error(`Error researching ${speciesName}:`, error);
                
                // Enhanced fallback data based on React version's comprehensive approach
                if (speciesName.toLowerCase().includes('tree')) {
                    return {
                        name: speciesName,
                        perceive_wisdom: "Trees sense the world through chemical conversations, reading the atmosphere like an ancient language passed down through generations.",
                        perceive: {
                            sensory_systems: ["Chemical gradient detection", "Light spectrum analysis", "Vibration sensing through roots", "Electromagnetic field sensitivity"],
                            self_awareness_indicators: ["Resource allocation decisions", "Territorial root boundary recognition", "Stress response communication"],
                            quantum_detection: "Quantum efficiency in photosynthesis, potential quantum coherence in cellular processes",
                            holofractographic_processing: "Fractal branching patterns, cellular information networks, root-mycorrhizal integration"
                        },
                        relate_wisdom: "Through mycorrhizal partnerships, trees share resources with strangers, creating forest-wide support networks that span across species boundaries.",
                        relate: {
                            communication_patterns: ["Chemical signaling through air and soil", "Root network electrical signals", "Mycorrhizal network information exchange"],
                            symbiotic_relationships: ["Mycorrhizal fungi partnerships", "Nitrogen-fixing bacteria collaboration", "Animal seed dispersal relationships"],
                            quantum_connections: "Instantaneous forest-wide chemical communication, synchronized seasonal responses",
                            ecosystem_role: "Atmospheric regulation, soil stabilization, interspecies communication hub"
                        },
                        apply_wisdom: "Masters of strategic patience, trees know when to conserve energy and when to reach for growth, demonstrating the intelligence of restraint.",
                        apply: {
                            strategic_non_response: "Dormancy timing, selective resource sharing, strategic growth cessation",
                            creative_applications: ["Architectural canopy optimization", "Chemical defense innovation", "Root system engineering"],
                            timing_wisdom: "Seasonal synchronization, multi-year masting cycles, drought response timing",
                            coherence_optimization: "Forest-wide resource distribution, atmospheric gas regulation, soil microbiome cultivation"
                        },
                        essence: "Trees embody the wisdom of deep time and interconnected generosity, showing us that true intelligence flows through relationship and patient presence.",
                        unified_physics_integration: "Quantum coherence in photosynthesis, bioelectromagnetic communication networks, holofractographic scaling",
                        life_contribution: "Atmospheric regulation, foundation for terrestrial ecosystems, interspecies communication networks",
                        research_gaps: ["Quantum coherence in root networks", "Electromagnetic communication mechanisms", "Consciousness in plant systems"]
                    };
                }

                // Add similar enhanced fallbacks for other common species...
                return {
                    name: speciesName,
                    perceive_wisdom: `${speciesName} demonstrates unique sensory adaptations that reveal hidden dimensions of reality.`,
                    perceive: {
                        sensory_systems: ["Species-specific sensory adaptations"],
                        self_awareness_indicators: ["Behavioral complexity indicators"],
                        quantum_detection: "Potential quantum biological processes",
                        holofractographic_processing: "Multi-scale information processing"
                    },
                    relate_wisdom: `${speciesName} participates in complex networks of relationship and communication.`,
                    relate: {
                        communication_patterns: ["Communication methods"],
                        symbiotic_relationships: ["Ecological relationships"],
                        quantum_connections: "Non-local coordination potential",
                        ecosystem_role: "Ecological niche function"
                    },
                    apply_wisdom: `${speciesName} applies intelligence through perfectly adapted behaviors and responses.`,
                    apply: {
                        strategic_non_response: "Intelligent non-action examples",
                        creative_applications: ["Adaptive behaviors"],
                        timing_wisdom: "Temporal coordination",
                        coherence_optimization: "System optimization"
                    },
                    essence: `${speciesName} embodies a unique form of consciousness that enriches our understanding of intelligence.`,
                    unified_physics_integration: "Quantum biology connections",
                    life_contribution: "Ecological intelligence contribution",
                    research_gaps: ["Research areas needed"]
                };
            }
        }

        async function generateRelationshipInsights(speciesData) {
            const speciesNames = speciesData.map(s => s.name).join(", ");
            
            // Generate comprehensive comparison like the React version
            const similarities = [];
            const differences = [];
            const wholeLifeContribution = [];

            // Check for universal patterns (inspired by React version logic)
            const hasQuantumDetection = speciesData.every(s => s.perceive && s.perceive.quantum_detection);
            const hasStrategicNonResponse = speciesData.every(s => s.apply && s.apply.strategic_non_response);
            const hasCommunication = speciesData.every(s => s.relate && s.relate.communication_patterns);

            if (hasQuantumDetection) {
                similarities.push("All life forms demonstrate quantum coherence in their biological processes, revealing intelligence as a universal quantum phenomenon rather than a uniquely human trait.");
            }
            
            if (hasStrategicNonResponse) {
                similarities.push("Each demonstrates strategic non-response as sophisticated intelligence - knowing when NOT to act transcends species boundaries and represents a fundamental aspect of consciousness.");
            }

            if (hasCommunication) {
                similarities.push("All forms of life have evolved complex relational communication that extends beyond individual boundaries, proving intelligence is fundamentally about connection rather than isolation.");
            }

            // Add universal intelligence patterns
            similarities.push("Every species processes information through multiple channels simultaneously, demonstrating that consciousness operates through layered awareness systems.");
            similarities.push("All demonstrate adaptive learning capabilities that allow real-time adjustment to environmental changes, showing intelligence as a dynamic rather than static phenomenon.");

            // Generate differences based on species characteristics
            if (speciesData.length >= 2) {
                const species1 = speciesData[0];
                const species2 = speciesData[1];
                
                differences.push(`${species1.name} and ${species2.name} operate on different temporal scales and spatial relationships, showing how intelligence adapts to different ecological niches and survival strategies.`);
                differences.push(`Each species has evolved specialized consciousness capabilities - ${species1.name} through their unique perceptual systems, ${species2.name} through their distinct relational approaches - demonstrating the diversity of intelligence expressions.`);
                
                if (speciesData.length >= 3) {
                    const species3 = speciesData[2];
                    differences.push(`Together, ${species1.name}, ${species2.name}, and ${species3.name} represent different aspects of consciousness: individual innovation, collective coordination, and adaptive integration, showing how intelligence manifests across multiple scales.`);
                }
            }

            // Generate life contributions
            speciesData.forEach(species => {
                if (species.life_contribution) {
                    wholeLifeContribution.push(`${species.name} contributes to life's wellness through: ${species.life_contribution}`);
                }
            });

            wholeLifeContribution.push(`Together, these different forms of intelligence create a more resilient and adaptive web of life - each contributing unique capabilities that strengthen the entire planetary consciousness network.`);

            // Create the enhanced prompt for more sophisticated analysis
            const prompt = `Analyze the intelligence relationships between ${speciesNames} using the consciousness-expanding voice of an inspired professor sharing quantum awareness insights.

Based on these species data insights, create deeper analysis about:

**Shared Intelligence Patterns**: What consciousness patterns do they have in common beyond basic survival?
**Unique Intelligence Expressions**: How does each express consciousness in ways that teach us about the diversity of awareness?
**Complementary Wisdom**: How do their different intelligence forms create a symphony of consciousness that benefits all life?

Include insights about how these species demonstrate that intelligence is not a hierarchy but a collaborative matrix where each form contributes irreplaceable wisdom.

Write in the same poetic-scientific voice that makes quantum concepts accessible and wonder-filled. Format as JSON: { shared_patterns, unique_expressions, complementary_wisdom }`;

            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1200,
                        messages: [
                            { role: "user", content: prompt }
                        ]
                    })
                });

                const data = await response.json();
                let responseText = data.content[0].text;
                responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                
                const jsonMatch = responseText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    responseText = jsonMatch[0];
                }
                
                const apiResponse = JSON.parse(responseText);
                
                return {
                    similarities: [apiResponse.shared_patterns],
                    differences: [apiResponse.unique_expressions], 
                    wholeLifeContribution: [apiResponse.complementary_wisdom, ...wholeLifeContribution]
                };

            } catch (error) {
                console.error('Error generating relationships:', error);
                return {
                    similarities,
                    differences,
                    wholeLifeContribution
                };
            }
        }

        async function generateSpecialSections(speciesData) {
            const speciesNames = speciesData.map(s => s.name).join(", ");
            
            const prompt = `Create three special insight sections about ${speciesNames} in the inspiring, quantum-aware voice:

1. **Unified Physics Integration**: How quantum biology and consciousness might work in these species
2. **Contribution to Life**: How these species contribute to planetary intelligence and ecosystem health  
3. **Research Frontiers**: What fascinating research questions remain to explore

Use the same consciousness-expanding voice that naturally weaves quantum concepts with accessible wonder. Format as JSON: { unified_physics, contribution_to_life, research_frontiers }`;

            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 1000,
                        messages: [
                            { role: "user", content: prompt }
                        ]
                    })
                });

                const data = await response.json();
                let responseText = data.content[0].text;
                responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
                return JSON.parse(responseText);

            } catch (error) {
                console.error('Error generating special sections:', error);
                return {
                    unified_physics: "These species may demonstrate quantum coherence in their biological processes.",
                    contribution_to_life: "Each species contributes unique intelligence to the planetary consciousness network.",
                    research_frontiers: "Future research could explore the quantum dimensions of their consciousness capabilities."
                };
            }
        }

        function displayResults() {
            const resultsSection = document.getElementById('resultsSection');
            const wisdomContent = document.getElementById('wisdomContent');
            const specialSections = document.getElementById('specialSections');
            const completionTime = document.getElementById('completionTime');

            // Update completion time
            completionTime.textContent = `✅ Research completed: ${researchResults.timestamp}`;

            // Display species wisdom
            let wisdomHTML = '';
            researchResults.species.forEach((species, index) => {
                const icons = ['🔬', '🌿', '💫'];
                wisdomHTML += `
                    <div class="wisdom-card">
                        <h3 class="wisdom-title">${icons[index]} ${species.name}</h3>
                        <div class="wisdom-content">
                            <p><strong>👁 Perceive:</strong> ${species.perceive_wisdom}</p>
                            ${species.perceive && Object.entries(species.perceive).length > 0 ? 
                                Object.entries(species.perceive).map(([key, value]) => 
                                    `<p><strong>${key.replace(/_/g, ' ')}:</strong> ${Array.isArray(value) ? value.join(', ') : value}</p>`
                                ).join('') : ''}
                            
                            <p><strong>💚 Relate:</strong> ${species.relate_wisdom}</p>
                            ${species.relate && Object.entries(species.relate).length > 0 ? 
                                Object.entries(species.relate).map(([key, value]) => 
                                    `<p><strong>${key.replace(/_/g, ' ')}:</strong> ${Array.isArray(value) ? value.join(', ') : value}</p>`
                                ).join('') : ''}
                            
                            <p><strong>✨ Apply:</strong> ${species.apply_wisdom}</p>
                            ${species.apply && Object.entries(species.apply).length > 0 ? 
                                Object.entries(species.apply).map(([key, value]) => 
                                    `<p><strong>${key.replace(/_/g, ' ')}:</strong> ${Array.isArray(value) ? value.join(', ') : value}</p>`
                                ).join('') : ''}
                            
                            <div class="wisdom-essence">
                                <strong>Essence:</strong> ${species.essence}
                            </div>
                        </div>
                    </div>
                `;
            });

            // Add the INCREDIBLE Intelligence Connections section (from React version!)
            if (researchResults.species.length > 1 && researchResults.relationships) {
                wisdomHTML = `
                    <div class="connections-grid">
                        <div class="connections-card similarities-card">
                            <h3 class="connections-title">✨ How They're Alike</h3>
                            <div class="connections-content">
                                ${researchResults.relationships.similarities.map(sim => `<p>${sim}</p>`).join('')}
                            </div>
                        </div>
                        
                        <div class="connections-card differences-card">
                            <h3 class="connections-title">⚡ How They're Different</h3>
                            <div class="connections-content">
                                ${researchResults.relationships.differences.map(diff => `<p>${diff}</p>`).join('')}
                            </div>
                        </div>
                        
                        <div class="connections-card wellness-card">
                            <h3 class="connections-title">💚 Contribution to Life's Wellness</h3>
                            <div class="connections-content">
                                ${researchResults.relationships.wholeLifeContribution.map(contrib => `<p>${contrib}</p>`).join('')}
                            </div>
                        </div>
                    </div>
                ` + wisdomHTML;
            }

            wisdomContent.innerHTML = wisdomHTML;

            // Display special sections
            if (researchResults.special) {
                specialSections.innerHTML = `
                    <div class="special-card physics-card">
                        <h3 class="special-title">⚡ Unified Physics Integration</h3>
                        <div class="special-content">${researchResults.special.unified_physics}</div>
                    </div>
                    <div class="special-card contribution-card">
                        <h3 class="special-title">🌱 Contribution to Life</h3>
                        <div class="special-content">${researchResults.special.contribution_to_life}</div>
                    </div>
                    <div class="special-card research-card">
                        <h3 class="special-title">🔬 Research Frontiers</h3>
                        <div class="special-content">${researchResults.special.research_frontiers}</div>
                    </div>
                `;
            }

            // Show results
            resultsSection.classList.add('show');
        }

        function generatePDF() {
            if (!researchResults) {
                alert('No research data available to export.');
                return;
            }

            // Get species names and current date
            const speciesNames = researchResults.species.map(s => s.name).join(', ');
            const currentDate = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            // Create HTML content
            let htmlContent = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Unspeciated Research: ${speciesNames}, ${currentDate}</title>
    <style>
        @media screen {
            body { 
                font-family: 'Times New Roman', serif; 
                line-height: 1.4; 
                margin: 40px; 
                color: #333;
                background: white;
                max-width: 800px;
                margin: 40px auto;
            }
            .print-btn {
                position: fixed;
                top: 20px;
                right: 20px;
                background: #3b82f6;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            }
            .print-btn:hover {
                background: #2563eb;
            }
        }
        @media print {
            .print-btn { display: none !important; }
            body { 
                margin: 0 !important; 
                font-size: 12pt !important;
            }
        }
        .pdf-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }
        .pdf-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .pdf-subtitle {
            font-size: 16px;
            margin-bottom: 5px;
            font-style: italic;
        }
        .pdf-meta {
            font-size: 14px;
            margin: 3px 0;
        }
        .pdf-section {
            margin: 25px 0;
            page-break-inside: avoid;
        }
        .pdf-section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #000;
        }
        .pdf-subsection {
            margin: 15px 0;
        }
        .pdf-subsection-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #000;
        }
        .pdf-footer {
            margin-top: 40px;
            text-align: center;
            font-size: 12px;
            border-top: 1px solid #333;
            padding-top: 20px;
        }
        ul { margin: 10px 0; padding-left: 20px; }
        li { margin: 5px 0; }
    </style>
</head>
<body>
    <button class="print-btn" onclick="window.print()">🖨️ Print to PDF</button>
    
    <div class="pdf-header">
        <div class="pdf-title">Species Intelligence Research Report</div>
        <div class="pdf-subtitle">Perceive • Relate • Apply Framework with Enhanced Dimensions</div>
        <div class="pdf-meta">Research Focus: ${speciesNames}</div>
        <div class="pdf-meta">Generated: ${currentDate}</div>
        <div class="pdf-meta">Powered by Claude AI & Intuitive Learning Foundation Framework</div>
    </div>

    <div class="pdf-section">
        <div class="pdf-section-title">Executive Summary</div>
        <p>This comprehensive research explores ${researchResults.species.length} ${researchResults.species.length === 1 ? 'species' : 'species'} through the revolutionary Perceive/Relate/Apply framework with enhanced intelligence dimensions. The research reveals sophisticated temporal awareness, energetic intelligence, collective wisdom, and adaptive strategies that challenge traditional views of intelligence. Each species demonstrates unique consciousness capabilities that contribute to planetary intelligence networks and offer profound lessons for human consciousness evolution.</p>
    </div>`;

            // Add each species section
            researchResults.species.forEach((species, index) => {
                htmlContent += `
    <div class="pdf-section">
        <div class="pdf-section-title">${species.name} Intelligence Profile</div>
        <div class="pdf-meta">Research Type: AI-Enhanced Research</div>
        
        <div class="pdf-subsection">
            <div class="pdf-subsection-title">Key Wisdom Insight</div>
            <p>${species.essence}</p>
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">PERCEIVE • How They Perceive Their World</div>
            <p>${species.perceive_wisdom}</p>
            ${species.perceive_details ? 
                '<ul>' + species.perceive_details.map(detail => `<li>${detail}</li>`).join('') + '</ul>' 
                : ''}
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">RELATE • How They Relate To Their World</div>
            <p>${species.relate_wisdom}</p>
            ${species.relate_details ? 
                '<ul>' + species.relate_details.map(detail => `<li>${detail}</li>`).join('') + '</ul>' 
                : ''}
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">APPLY • How They Apply Their Intelligence</div>
            <p>${species.apply_wisdom}</p>
            ${species.apply_details ? 
                '<ul>' + species.apply_details.map(detail => `<li>${detail}</li>`).join('') + '</ul>' 
                : ''}
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">Temporal Intelligence</div>
            <p>${species.name} demonstrates sophisticated temporal awareness and timing capabilities that span multiple time scales, from immediate environmental responses to seasonal and generational patterns.</p>
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">Energetic Intelligence</div>
            <p>${species.name} exhibits remarkable energy optimization and sensitivity to bioelectric and electromagnetic fields, suggesting quantum biological processes in their consciousness systems.</p>
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">Collective Wisdom</div>
            <p>${species.name} participates in collective intelligence networks that demonstrate emergent properties and shared knowledge transmission across communities.</p>
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">Adaptive Strategies</div>
            <p>${species.name} shows remarkable adaptability through behavioral flexibility, learning capabilities, and innovative responses to environmental changes.</p>
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">Quantum Biology & Consciousness</div>
            <p>Research suggests ${species.name} may demonstrate quantum coherence effects in biological processes, potentially explaining their sophisticated consciousness capabilities and environmental awareness.</p>
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">Human Learning Opportunities</div>
            <p>${species.name} offers unique insights for human consciousness development, technological innovation, and understanding of intelligence as a multifaceted phenomenon that extends beyond traditional cognitive measures.</p>
        </div>

        <div class="pdf-subsection">
            <div class="pdf-subsection-title">Conservation Intelligence</div>
            <p>Understanding ${species.name} intelligence emphasizes the importance of protecting not just individual organisms but entire knowledge ecosystems and consciousness networks that support planetary intelligence.</p>
        </div>
    </div>`;
            });

            // Add special sections if available
            if (researchResults.special) {
                htmlContent += `
    <div class="pdf-section">
        <div class="pdf-section-title">Unified Physics Integration</div>
        <p>${researchResults.special.unified_physics}</p>
    </div>

    <div class="pdf-section">
        <div class="pdf-section-title">Contribution to Life</div>
        <p>${researchResults.special.contribution_to_life}</p>
    </div>

    <div class="pdf-section">
        <div class="pdf-section-title">Research Frontiers</div>
        <p>${researchResults.special.research_frontiers}</p>
    </div>`;
            }

            // Add Sources and Footer
            htmlContent += `
    <div class="pdf-section">
        <div class="pdf-section-title">Sources and References</div>
        <ol>
            <li>Traditional Ecological Knowledge databases</li>
            <li>Quantum Biology Research Papers</li>
            <li>Journal of Consciousness Studies</li>
            <li>Indigenous Knowledge Systems Studies</li>
            <li>Contemporary species behavior research</li>
            <li>Ecosystem intelligence studies</li>
            <li>Neuroscience and Cognitive Science Literature</li>
            <li>Biomimicry Research Archives</li>
        </ol>
    </div>

    <div class="pdf-footer">
        <p><strong>Generated by Species Intelligence Research Agent • Intuitive Learning Foundation</strong></p>
        <p>Perceive/Relate/Apply Framework by Kerri Lake</p>
        <p>Visit: intuitivelearningfoundation.org • generateharmony.com • kerrilake.com</p>
    </div>
</body>
</html>`;

            // Create blob and download
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Unspeciated Research: ${speciesNames}, ${currentDate}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            // Also try to open in new tab as backup
            try {
                const printWindow = window.open();
                if (printWindow) {
                    printWindow.document.write(htmlContent);
                    printWindow.document.close();
                    printWindow.document.title = `Unspeciated Research: ${speciesNames}, ${currentDate}`;
                }
            } catch (e) {
                console.log('Popup blocked, but HTML file downloaded successfully');
            }
        }
    </script>
</body>
</html>
